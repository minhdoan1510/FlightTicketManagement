USE DataStore

CREATE TABLE Airport
(
	AirportId VARCHAR(10) NOT NULL PRIMARY KEY,
	AirportName NVARCHAR(50) NOT NULL,
	CityId VARCHAR(10) NOT NULL
);

CREATE TABLE Flight
(
	FlightId VARCHAR(10) NOT NULL PRIMARY KEY,
	Price MONEY NOT NULL,
	OriginAP VARCHAR(10) NOT NULL,
	DestinationAP VARCHAR(10) NOT NULL,
	Date DATE NOT NULL,
	Time TIME NOT NULL,
	TotalSeat INTEGER NOT NULL
);

CREATE TABLE Transit
(
	FlightId VARCHAR(10) NOT NULL,
	AirportId VARCHAR(10) NOT NULL,
	Duration TIME NOT NULL,
	Note NTEXT NULL
);

CREATE TABLE Class
(
	ClassId VARCHAR(10) NOT NULL PRIMARY KEY,
	ClassName NVARCHAR(50) NOT NULL,
	PriceRatio FLOAT NOT NULL
);

ALTER TABLE dbo.Ticket
DROP COLUMN TicketIDBeginPoint

ALTER TABLE dbo.Ticket
DROP COLUMN TicketIDEndPoint

ALTER TABLE Ticket
add FlightId VARCHAR(10) NOT NULL
ALTER TABLE Ticket
add ClassId VARCHAR(10) NOT NULL
ALTER TABLE Ticket
add Type INTEGER NOT NULL

ALTER TABLE dbo.Flight
ADD CONSTRAINT Origin_FK FOREIGN KEY(OriginAP) REFERENCES dbo.Airport(AirportId)

ALTER TABLE dbo.Flight
ADD CONSTRAINT Dest_FK FOREIGN KEY(OriginAP) REFERENCES dbo.Airport(AirportId)

ALTER TABLE dbo.Transit
ADD CONSTRAINT Flight_FK FOREIGN KEY(FlightId) REFERENCES dbo.Flight(FlightId)

ALTER TABLE dbo.Transit
ADD CONSTRAINT Airport_FK FOREIGN KEY(AirportId) REFERENCES dbo.Airport(AirportId)
ALTER TABLE dbo.Airport
ADD CONSTRAINT City_FK FOREIGN KEY(CityId) REFERENCES dbo.City(CityId)
ALTER TABLE Ticket
ADD CONSTRAINT Flight_Ticket_FK FOREIGN KEY(FlightID) REFERENCES dbo.Flight(FlightId)
ALTER TABLE Ticket
ADD CONSTRAINT Class_FK FOREIGN KEY(ClassId) REFERENCES dbo.Class(ClassId)
ALTER TABLE dbo.Transit
ADD CONSTRAINT Flight_AP_PK PRIMARY KEY(FlightId,AirportId)